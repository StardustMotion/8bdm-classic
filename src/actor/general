// see acs_source/data.acs
const int MOB_ON_SPAWN = 0;
const int XY_DIST = 1;
const int Z_DIST = 2;
const int IS_GONE = 3;
const int COPY_VELOCITY = 4;


// used to warp to/copy velocity of another actor i.e a remote mine stuck on an actor
actor "8C follow me" : once {}
actor "8C follower" : once {}

// aliases
actor proj : BasicProjectile { obituary "$8C_OBIT_DEFAULT" }
actor watcher : BasicWatcher {}
actor gfx : BasicGraphicEffect {}
actor item : CustomInventory {}
// actor once : inventory { inventory.amount 1 inventory.maxamount 1} // this one is defined in vanilla

const int FLAG_MOB = 0x1; // is a mob (for pain management)
const int FLAG_DEFLECT = 0x2; // invulnerable and reflect attacks
actor "8C flags" : once { inventory.maxamount 0xFFFFFFFF }

actor "8C Deflect" : item {
    states { 
        pickup: 
        TNT1 A 0 A_GiveInventory("8C flags", FLAG_DEFLECT)
        TNT1 A 0 A_ChangeFlag("NODAMAGE", true)
        TNT1 A 0 A_ChangeFlag("REFLECTIVE", true)
        TNT1 A 0 A_ChangeFlag("DONTRIP", true)
        TNT1 A 0 A_ChangeFlag("NORADIUSDMG", true)
        stop
    }
}

actor "8C Undeflect" : "8C Deflect" { states { 
    pickup: 
    TNT1 A 0 A_TakeInventory("8C flags", FLAG_DEFLECT)
    TNT1 A 0 A_ChangeFlag("NODAMAGE", false)
    TNT1 A 0 A_ChangeFlag("REFLECTIVE", false)
    TNT1 A 0 A_ChangeFlag("DONTRIP", false)
    TNT1 A 0 A_ChangeFlag("NORADIUSDMG", false)
    stop
}
}

actor "8C Mob" {
    // private:
	radius 16 height 32 health 100 scale 2.5 obituary "%o was kill" mass 9999
	+ISMONSTER +USEDAMAGEEVENTSCRIPT +USESPAWNEVENTSCRIPT
	+SOLID +CANPASS +ACTIVATEMCROSS +SHOOTABLE +COUNTKILL
	+CANPUSHWALLS +CANUSEWALLS +MOVEWITHSECTOR +DONTBLAST +FLOORCLIP
    //species 8C_unsolid  +THRUSPECIES
    health 100 var int user_attack;
    obituary "$8C_OBIT_DEFAULT"
    //stencilcolor "white"
	// var score	
	states {
		spawn:
            TNT1 A 0 nodelay A_GiveInventory("8C flags", FLAG_MOB)
            TNT1 A 0 A_JumpIf(true, "onSpawn")
            goto onSpawn
        onSpawn:
            TNT1 A 0 A_JumpIf(true, "idle")
            goto idle
        idle:
            TNT1 A 35
            loop
        sightCheck:
            TNT1 A 0 A_JumpIf(CallACS("8C", IS_GONE, AAPTR_TARGET), "reset")
            TNT1 A 0 A_JumpIfInTargetLOS("see",360,0,meleerange,0)
        reset:
            TNT1 A 0 A_ClearTarget
            TNT1 A 0 A_JumpIf(true, "idle")
            goto idle
        death:
            TNT1 A 0 A_SpawnItemEx("ExplosionEffect1",0,0,height>>1)
            TNT1 A 0 A_PlaySoundEx("8CPAIN01", CHAN_VOICE)
            stop}}



actor "8C Mob contact" : proj {
    // private:
        var int user_PierceRipper; +SERVERSIDEONLY +RIPPER 
        bouncetype classic +BOUNCEONFLOORS +BOUNCEONCEILINGS +BOUNCEONWALLS +CANBOUNCEWATER +DONTSPLASH
    // public:
        damage (10) PoisonDamage 10,1,3  damagetype "Normal" radius 32 height 62 accuracy 0
    states {
    spawn: 
        TNT1 A 0 nodelay A_GiveToTarget("8C follow me")
        TNT1 A 0 ACS_NamedExecuteWithResult("8C", COPY_VELOCITY, AAPTR_TARGET)
    idle:
        TNT1 A 1 A_Warp(AAPTR_TARGET,0,0,accuracy,WARPF_NOCHECKPOSITION)
        TNT1 A 0 A_JumpIfInTargetInventory("8C follow me", 1, "idle")
        stop}}
            

actor "8C Deflect gfx" : gfx { alpha 1.0 translation "192:192=4:4", "198:198=81:81"
    scale 2.0
    states {
        spawn: TNT1 A 0
            8CAA A 1 
            8CAA A 0 A_FadeOut(0.12) 8CAA A 1 A_SetScale(3.0)
            8CAA A 0 A_FadeOut(0.12) 8CAA B 1 A_SetScale(1.5)
            8CAA A 0 A_FadeOut(0.12) 8CAA B 1 A_SetScale(2.0)
            stop}}


actor "8C Shiny" : item {
    states {
        pickup:
            TNT1 A 0 A_SpawnItemEx("8C Shiny Aura",0,0,0, 0,0,0, radius>>4,SXF_ABSOLUTEANGLE )
            stop}}

actor "8C Shiny Aura" : watcher {
    states {
        spawn:
            TNT1 A 0 nodelay A_SetArg(0,8-angle)
            TNT1 A 0 A_JumpIf(args[0]>=2, "main")
            TNT1 A 0  A_SetArg(0,2)            
        main:
            TNT1 A 6 A_SetTics(args[0]) 
            TNT1 A 0 A_JumpIf(CallACS("8C", IS_GONE, AAPTR_TARGET), "death")
            TNT1 A 0 A_GiveInventory("8C Shiny __Light", 1, AAPTR_TARGET)
            loop}}
            
actor "8C Shiny __Light" : item { states {  pickup: TNT1 A 0 A_SpawnItemEx("8C Shiny Light", 
        random(0,radius*1.75), 0, 8,
       velx,vely,random(2,height>>3),
       random(0,45)<<3,
       SXF_TRANSFERTRANSLATION|SXF_ABSOLUTEVELOCITY) stop }}

actor "8C Shiny Light" : gfx { +BRIGHT alpha 0.75
    states {
        spawn:
         8CAA CCDDEE 3 A_FadeOut(0.06)
         stop}}


// actor "8C Protoman" : Megaman {
//     player.displayname "8C Protoman"
//     player.startitem "MagnetMissileWep"
//     +THRUSPECIES species 8C_unsolid
// }

